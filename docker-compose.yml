services:

  youkok2-db:
    image: postgres:14.9
    container_name: "youkok2_db_dev"
    environment:
      POSTGRES_USER: youkok2
      POSTGRES_PASSWORD: youkok2
      POSTGRES_DB: youkok2
    ports:
      - '5444:5432'
    healthcheck:
      test: [ 'CMD-SHELL', 'pg_isready -U postgres' ]
      interval: 10s
      timeout: 5s
      retries: 5

  youkok2-cache:
    image: "redis:6.0.8-alpine"
    container_name: "youkok2_cache_dev"
    ports:
      - "6379:6379"

  youkok2-php:
    build:
      context: .
      dockerfile: docker_php.Dockerfile
      args:
        - ENV=dev
    container_name: "youkok2_php_dev"
    ports:
      - "9000"
    env_file:
      - env_php_dev.env
    volumes:
      - ./youkok2:/code/site
      - ./_docker/files:/code/files
    depends_on:
      - youkok2-db
      - youkok2-cache
    links:
      - youkok2-db
      - youkok2-cache

  youkok2-nginx:
    build:
      context: .
      dockerfile: docker_nginx.Dockerfile
      args:
        - ENV=dev
    container_name: "youkok2_nginx_dev"
    ports:
      - "8091:80"
    volumes:
      - ./_docker/site.conf:/etc/nginx/conf.d/site.conf
      - ./static:/static
    depends_on:
      - youkok2-php
    links:
      - youkok2-php
